{% extends "base.html" %}
{% import "articles/macros.html" as macros without context %}
{% from "_meta-macro.html" import meta without context %}

{% block meta_title %}{{ article.title }}{% endblock %}
{% block metas %}
  {{ meta('name=description', article.summary) }}
  {{ meta('name=author', article.author) }}
{% endblock %}

{% block metas_social %}
  {{ meta('property=article:author', article.author) }}
  {{ meta('property=og:image', absolute(article.image_url)) }}
  {{ meta('property=og:url', request.url) }}
  {{ meta('property=og:title', self.meta_title()) }}
  {{ meta('property=og:type', 'article') }}
  {{ meta('property=og:description', 'pan-European news, features and opinions') }}
  {{ meta('property=og:site_name', 'Caf√©babel') }}
  {{ meta('property=og:locale', current_language) }}
  {{ meta('name=twitter:card', 'summary') }}
  {{ meta('name=twitter:image', absolute(article.image_url)) }}
  {{ meta('name=twitter:title', self.meta_title()) }}
  {{ meta('name=twitter:description', 'pan-European news, features and opinions') }}
  {{ meta('name=twitter:url', request.url) }}
{% endblock %}

{% block body_class %}article-page{% endblock %}

{% block body %}
<article>
    {% if article.has_image %}
    <img src="{{ article.image_url }}" alt="Image for {{ article.title }}">
    {% endif %}
    <h1>{{ article.title }}</h1>

    {{ macros.article_meta(article) }}

    {% block tag_list %}
    {% if article.tags %}
      <p class=tags-list>
        {% for tag in article.tags -%}
          <a href={{ url_for('tags.detail', slug=tag.slug) }}>{{ tag.name }}</a>{% if loop.last %}.{% else %}, {% endif %}
        {%- endfor %}
      </p>
    {% endif %}
    {% endblock %}

    <div class=article-language-selector>
      <ul>
        <li><span>{{ article.language }}</span></li>
          {% if article.is_translation %}
            <li class=original-language>Translated from <a href="{{ article.original_article.detail_url }}">{{ article.original_article.language }}</a></li>
          {% endif %}
          {% if translations_publisheds %}
            {% for translation in translations_publisheds %}
                <li class=translated-language><a href={{ translation.detail_url }}>{{ translation.language }}</a></li>
            {% endfor %}
          {% endif %}
          {% for lang_code, lang_label in get_languages() %}
            {% if article.language != lang_code and lang_code not in translations_langs %}
              {% if article.is_translation %}
                {% if lang_code != article.original_article.language %}
                  <li class=to-translate-languages><a href="{{ url_for('translations.create') }}?lang={{ lang_code }}&original={{ article.original_article.id }}">{{ lang_code }}</a></li>
                {% endif %}
                {% elif article.is_translated_in(lang_code) %}
                  <li class=translated-language><a href={{ article.get_translation(lang_code).detail_url }}>{{ lang_code }}</a></li>
                {% else %}
                  <li class=to-translate-languages><a href="{{ url_for('translations.create') }}?lang={{ lang_code }}&original={{ article.id }}">{{ lang_code }}</a></li>
                {% endif %}
             {% endif %}
          {% endfor %}
      </ul>
    </div>

    {% if article.summary %}
    <p class=summary>{{ article.summary }}</p>
    {% endif %}

    {{ article.body|markdown }}

  {% block share_nav %}
  <nav class=share>
    <a href="https://twitter.com/share?url={{ request.url|quote_plus }}&text={{ article.title }}&via=cafebabel_eng">Twitter</a>
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.url|quote_plus }}">Facebook</a>
  </nav>
  {% endblock %}
  {% if current_user.has_role('editor') and article.is_published %}
    <p>
      <a class=button href={{ url_for('articles.edit', article_id=article.id) }}>Edit this article</a>
    </p>
  {% endif %}

  {% if article.is_translation %}
    <p>
      Translated from <a href="{{ article.original_article.detail_url }}">{{ article.original_article.title }}</a> by {{ article.translator }}.
    </p>
  {% endif %}

  {% if translations_drafts %}
    <p>Review this article in:</p>
    <ul>
      {% for translation in translations_drafts %}
        <li>{{ translation.language }}: <a href={{ url_for('translations.detail', id=translation.id) }}>{{ translation.title }}</a></li>
      {% endfor %}
    </ul>
  {% endif %}

</article>
{% endblock %}
