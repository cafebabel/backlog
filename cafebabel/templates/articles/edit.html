{% extends "base.html" %}
{% import "articles/macros.html" as macros without context %}
{% from "_macro-extra-js.html" import extra_js without context %}

{% block extra_js %}
  {{ extra_js(url_for('static', filename='js/noise.js')) }}
  {{ extra_js(url_for('static', filename='js/articles-tags.js')) }}
  {{ extra_js(url_for('static', filename='js/image-preview.js')) }}
{% endblock %}

{% block body_class %}create-article-page{% endblock %}
{% block body %}
<form method=post action={{ url_for('articles.edit', article_id=article.id) }} enctype=multipart/form-data>
  <input type=hidden name=id value="{{ article.id }}">
  <div class=file>
    <label for=image>Image</label>
    {% if article.image_filename %}
      <output><img src={{ article.image_url }} alt="Image for {{ article.title }}"></output>
      <div class=checkbox>
        <label for=delete-image>Delete image</label>
        <input type=checkbox name=delete-image id=delete-image value=1>
      </div>
    {% else %}
      <canvas class=noise></canvas>
      <output></output>
    {% endif %}
    <label for=image>Click here to add a cover picture or Drag & drop your pic here <small>Recommended file size: 1200x467px, less than 1Mo</small></label>
    <input type=file id=image name=image>
  </div>
  <h1 class="edit active">
      <label for=title>Title</label>
      <input id=title name=title value="{{ article.title }}" required>
  </h1>
  <div class=article-settings>
      <div class=select>
          <label for=language>
              <select id=language name=language required>
                  <optgroup label=Language>
                      {% for language in get_languages() %}
                      <option value={{language[0]}}{% if article.language == language[0] %} selected{% endif %}>{{ language[1] }}</option>
                      {% endfor %}
                  </optgroup>
              </select>
          </label>
      </div>
      <div class=select>
          <label for=category>
              <select id=category name=category required>
                  <optgroup label=Category>
                      {% for category in get_categories() %}
                      <option value={{ category }}{% if article.category == category %} selected{% endif %}>{{ category }}</option>
                      {% endfor %}
                  </optgroup>
              </select>
          </label>
      </div>
      {% if current_user.has_role('editor') %}
      <div class=select>
          <label for=status>
              <select id=status name=status required>
                  <optgroup label=Status>
                      <option value=draft>Draft</option>
                      <option value=published selected>Published</option>
                  </optgroup>
              </select>
          </label>
      </div>
      <div class=select>
          <label for=author>
              <select id=author name=author required>
                  <optgroup label=Author>
                      {% for author in authors %}
                      <option value={{author.id}} {% if article.author == author %}selected{% endif %}>{{ author }}</option>
                      {% endfor %}
                  </optgroup>
              </select>
          </label>
      </div>
      {% endif %}
  </div>
  <div class=textarea>
    <label for=summary>Summary</label>
    <textarea id=summary name=summary required>{{ article.summary }}</textarea>
  </div>
  <div class=textarea>
    <label for=body>Body</label>
    <textarea id=body name=body required>{{ article.body }}</textarea>
    {% include "articles/markdown-helper.html" %}
  </div>
  {{ macros.tags_fields(article) }}
  <input type=submit value=Save>
</form>

{% if current_user.has_role('editor') %}
<form method=post action={{ url_for('articles.delete', article_id=article.id) }}>
  <input type=submit value="Delete this article">
</form>
{% endif %}
{% endblock %}
